# Planbot Tickets
# Run `planbot start --help` for CLI options

# =============================================================================
# Hooks — run commands or prompts at lifecycle events
# =============================================================================
#
# Hook types:
#   shell  — runs a shell command    { type: shell, command: "..." }
#   prompt — sends prompt to Claude  { type: prompt, prompt: "..." }
#
# Hook events:
#   beforeAll      — once before processing any tickets
#   afterAll       — once after all tickets are processed
#   beforeEach     — before each ticket starts
#   afterEach      — after each ticket completes (success, failure, or skip)
#   onPlanGenerated — after plan generation, before approval
#   onApproval     — when a plan is approved
#   onComplete     — when a ticket completes successfully
#   onError        — when an error occurs during processing
#   onQuestion     — when Claude asks a question requiring input
#
# Environment variables available in shell hooks:
#   PLANBOT_EVENT          — hook event name (e.g. "beforeEach")
#   PLANBOT_TICKET_ID      — current ticket ID
#   PLANBOT_TICKET_TITLE   — current ticket title
#   PLANBOT_TICKET_STATUS  — current ticket status
#   PLANBOT_PLAN_PATH      — path to plan file (onPlanGenerated)
#   PLANBOT_PLAN           — plan content (onPlanGenerated, onApproval)
#   PLANBOT_ERROR          — error message (onError)
#   PLANBOT_QUESTION       — question text (onQuestion)
#   PLANBOT_QUESTION_ID    — question ID (onQuestion)
#
hooks:
  beforeAll:
    - type: prompt
      command: /clear

  afterAll:
    - type: prompt
      command: /typetest
    - type: prompt
      command: /commit

  beforeEach:
    - type: prompt
      command: /clear

  afterEach:
    - type: prompt
      command: /commit

  # onPlanGenerated:
  #   - type: prompt
  #     prompt: Review the generated plan and identify any risks or missing steps
  #   - type: shell
  #     command: cat "${PLANBOT_PLAN_PATH}"

  # onError:
  #   - type: shell
  #     command: echo "ERROR in ${PLANBOT_TICKET_ID}: ${PLANBOT_ERROR}"

  # onComplete:
  #   - type: shell
  #     command: echo "${PLANBOT_TICKET_ID} completed successfully"

# =============================================================================
# Tickets
# =============================================================================
#
# Required fields: id, title, description
# Optional fields: priority, planMode, acceptanceCriteria, dependencies, hooks, metadata
#
# planMode (default: true):
#   true  — generate a plan, wait for approval, then execute
#   false — skip planning and approval, execute directly from description
#
tickets:
  - id: test-001
    title: Update Readme 
    description: |
      We've just done a fair bit of work updating this app. i'd like you to make sure the readme is updated properly.
    complete: true

  - id: test-002
    title: Security audit
    description: |
      Since we will be calling external APIs like telegram with this app, i'd like you to plan and execute a full security audit

    complete: true
  - id: feature-001
    title: AI answers plans
    description: |
      I'd like to be able to have the option to have external AI apis answer the plans and questions, in the event that a user is busy and decides to use this feature. this should template the host repo's readme into the prompt, along with the ticket description and perhaps also some of the conversation history from claude. i want this to be strictly optional and not break any existing functionality.
      
  - id: feature-001
    title: add ticket via telegram
    description: |
      it's plausible that the list of plans will run out. i'd like the user to be able to send a ticket via the telegram bot. picking the create ticket command should lead the user through a ticket creation flow, where they answer questions and so on.

